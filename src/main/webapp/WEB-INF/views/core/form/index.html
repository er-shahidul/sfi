<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="formLayout" th:with="title=${title}">

<div layout:fragment="content">


    <div class="container" ng-app="sfiFormApp" style="margin-top: 15px;">

        <div class="row" ng-controller="FormHeaderCtrl">
            <div class="col-xs-2">

                <div th:if="${companyLogo != null}">
                    <img th:src="${{companyLogo}}" width="150" height="80"/>
                </div>
                <div th:unless="${ companyLogo }">
                    <img src="/assets/images/logo-placeholder.png" align="left" alt="logo-placeholder"/>
                </div>

            </div>

            <div class="col-xs-7">
                <div id="companyInfoLeft" class="pull-left">
                    <label>Company Name</label>
                    <label>Created by:</label>
                    <label>Creation date:</label>
                    <label>Last updated:</label>
                    <label>Percent complete:</label>
                </div>
                <div id="companyInfoRight">
                    <label th:text="${{ company.name }}"></label>
                    <span th:text="${{ form.createdBy.getFullname() }}"></span>
                    <span >[{{ form.cs10.createdAt | date: "dd-MMM, yyyy h:mma" }}]</span>
                    <span >[{{ form.cs10.updatedAt | date: "dd-MMM, yyyy h:mma"}}]</span>
                    <div class="progress">
                        <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" ng-style="progressClass()">
                            <span class="sr-only">{{ progress() }}% Complete (success)</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-3" id="formActions">

                <div class="formActionsNotice">
                    <span ng-show="daysLeft >= 0 "><big th:text="${{ days_until }}"></big> until form is due!</span>
                    <span ng-show="daysLeft &lt; 0" class="dueDate">Oh no! Your form is <span th:text=" - ${{ days_until }}"></span> days overdue!</span>
                    <br/>
                    <a href="mailto:rachel.dierolf@sfiprogram.org" ng-class="{'dueDate':  daysLeft &lt; 0}">Need help?</a>
                </div>

                <span class="glyphicon glyphicon-file print pull-right" tooltip="" aria-hidden="true" data-container="body" data-title="Print the entire form"  ng-click="printAllSection()"></span>

                <span class="glyphicon glyphicon-print print pull-right" aria-hidden="true"
                      tooltip="" data-container="body" data-title="Print this page only"
                      ng-click="printSection()"></span>
                <button type="button" class="btn pull-right" data-trigger="hover"
                        ng-class="canSubmit() ? 'btn-success' : 'btn-disabled' "
                        ng-click="canSubmit() &amp;&amp; submit()" >{{ submitText() }}</button>
            </div>
            <div class="modal fade" id="submit" tabindex="-1" role="dialog" aria-labelledby="submit" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                            <h4 class="modal-title" id="myModalLabel">Confirm Form Submission</h4>
                        </div>
                        <div class="modal-body">
                            Congratulations! Your form is ready for submission.  Keep in mind that once you confirm and submit your form you will only be able to view the form, but not edit it.
                        </div>
                        <div class="modal-footer">
                            <a data-dismiss="modal">Go back and review it</a>
                            <button type="button" class="btn btn-success" ng-click="formSubmit()">Yes, I'm ready. Submit my Form</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div id="formContainer">
                <div id="formNavigation" ng-controller="FormNavigationCtrl">
                    <div ng-show="isStepAllowed('cs1')"  class="formMenuItem" ng-click="goStep('cs1')">
                        <div class="circle {{ getClass('cs1') }}">1</div>
                        <span class="circleTxt {{ getClass('cs1') }}">Profile</span>
                    </div>
                    <div ng-show="isStepAllowed('cs2')"  class="formMenuItem section2" ng-click="goStep('cs2')">
                        <div class="circle {{ getClass('cs2') }}">2</div>
                        <span class="circleTxt {{ getClass('cs2') }}">Forestland<br/> Information</span>
                    </div>
                    <div ng-show="isStepAllowed('cs4')"  class="formMenuItem section3" ng-click="goStep('cs4')">
                        <div class="circle {{ getClass('cs4') }}">3</div>
                        <span class="circleTxt {{ getClass('cs4') }}" >Harvest &amp; Reforestation</span>
                    </div>
                    <div ng-show="isStepAllowed('cs6')"  class="formMenuItem section4" ng-click="goStep('cs6')">
                        <div class="circle {{ getClass('cs6') }}">4</div>
                        <span class="circleTxt {{ getClass('cs6') }}">Raw Material Supply</span>
                    </div>
                    <div ng-show="isStepAllowed('cs5')"  class="formMenuItem section5" ng-click="goStep('cs5')">
                        <div class="circle {{ getClass('cs5') }}">5</div>
                        <!-- V2 <span class="circleTxt {{ getClass('cs5') }}">Research Funding</span> -->
                        <span class="circleTxt {{ getClass('cs5') }}">Research, Conservation &amp; Community</span>
                    </div>
                    <div ng-show="isStepAllowed('cs7')"  class="formMenuItem section6" ng-click="goStep('cs7')">
                        <div class="circle {{ getClass('cs7') }}">6</div>
                        <span class="circleTxt {{ getClass('cs7') }}">
                            Issues of<br/>
                            Interest
                        </span>
                    </div>
                    <div ng-show="isStepAllowed('cs9')"  class="formMenuItem section7" ng-click="goStep('cs9')">
                        <div class="circle {{ getClass('cs9') }}">7</div>

                        <span class="circleTxt {{ getClass('cs9') }}">
                            <!-- Emerging Issues -->
                            FM New<br/>
                            Standard<br/>
                            Impacts
                        </span>
                    </div>
                    <div ng-show="isStepAllowed('cs10')"  class="formMenuItem section8" ng-click="goStep('cs10')">
                        <div class="circle {{ getClass('cs10') }}">8</div>
                        <span class="circleTxt {{ getClass('cs10') }}">
                            <!-- Market <br/>Survey (new!) -->
                            FS New<br/>
                            Standard<br/>
                            Impacts
                        </span>
                    </div>
                    <div ng-show="isStepAllowed('cs8')"  class="formMenuItem section9" ng-click="goStep('cs8')">
                        <!--<div class="circle {{ getClass('cs9') }}">9</div>-->
                        <div class=" {{ getClass('cs8') }}">&nbsp;</div>
                        <span class="circleTxt {{ getClass('cs8') }}" style="font-size: large;top: -12px">
                            <!-- Forest <br/>Management <br/>Standard <br/>Questions (new!) -->
                            SFI<br/>
                            Market<br/>
                            Survey
                        </span>
                    </div>
                    <br/>

                    <div ng-show="isStepAllowed('cs10')" class="first-desc" style="width:560px;">SFI annual progress report survey</div>
                    <div ng-show="isStepAllowed('cs10')" class="second-desc" style="width:175px;">2015 - 2019 Impacts</div>
                    <div ng-show="isStepAllowed('cs10')" class="second-desc" style="width:75px;">Optional</div>
                </div>

                <div class="formContent" ui-view="{{mode}}Container">
                </div>
            </div>
        </div>

    </div>

</div>


<div layout:fragment="script">

    <script th:src="@{/assets/js/libs/angular.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/libs/angular-sanitize.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/libs/angular-ui-router.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/libs/checklist-model.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/libs/angular-strap.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/libs/angular-strap.tpl.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/libs/angular-file-upload-shim.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/libs/angular-file-upload.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/libs/ui-bootstrap-tpls.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/libs/ui-bootstrap.min.js}" type="text/javascript"></script>


    <script th:src="@{/assets/partials/ViewTemplate.js}" type="text/javascript"></script>



    <script type="text/javascript">
        // <![CDATA[

        function camelize(str) {
          return str.replace(/(?:^\w|[A-Z]|\b\w)/g, function(letter, index) {
            return index == 0 ? letter.toLowerCase() : letter.toUpperCase();
          }).replace(/\s+/g, '');
        }

        var sfiV2 = {

            prepareForm : function(formData){

                var form = {};

                for(var i = 1; i<= 10; i++){
                    form['cs' + i] = {
                        isSectionEnabled : true
                    };
                }

                _.each(formData, function(val, key){
                    var match = key.match(/(cs[0-9]*)(.*)/);
                    if(match){

                        var section = match[1];
                        var attr = camelize(match[2]);

                        if(!form[section]){
                            form[section] = {
                                isSectionEnabled : true
                            };
                        }

                        form[section][attr] = val;
                    }else{
                        console.log(key, val);
                        form[key] = val;
                    }

                });

                return form;

            },

            getSectionData : function(section, form){

                //var formData = {};
                _.each(form, function(val, key){

                    var attr = camelize(section + ' ' + key);

                    formData[attr] = val;
                });

                return formData;
            }
        };

        // ]]>

    </script>

    <script th:inline="javascript">
        var formData  = [[${form}]];

        var form = {
            cs1  : [[${cs1}]],
            cs2  : [[${cs2}]],
            cs3  : [[${cs3}]],
            cs4  : [[${cs4}]],
            cs5  : [[${cs5}]],
            cs6  : [[${cs6}]],
            cs7  : [[${cs7}]],
            cs8  : [[${cs8}]],
            cs9  : [[${cs9}]],
            cs10 : [[${cs10}]]

        };

        var isPrint   = [[${print}]];
        var isAdmin   = [[${isAdmin}]];
        var mode      = [[${mode}]];
        var company   = [[${company}]];
        var countries = [[${countries}]];
        var regions   = [[${regions}]];
        var daysLeft  = [[${days_until}]];;
        var standardObjects = [[${standardObjects}]];


    </script>

    <script th:src="@{/assets/js/app/app.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormEmergingIssuesCtrl.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormFiberSourcingStandardCtrl.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormForestlandCtrl.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormForestManagementStandardCtrl.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormHarvestCtrl.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormHeaderCtrl.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormMarketSurveyCtrl.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormNavigationCtrl.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormPartnershipCtrl.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormProfileCtrl.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormRawMaterialCtrl.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/app/controllers/FormResFundingCtrl.js}" type="text/javascript"></script>

    <script type="text/javascript">

    // <![CDATA[

        var urlData = {
            companyId : company.id,
            isAdmin   : isAdmin
        };

        sfiFormApp.run(function($rootScope) {
            $rootScope.mode     = mode;
            $rootScope.company  = company;
            $rootScope.unit     = company.areaUnit.shortCode;
            $rootScope.form     = form;
            $rootScope.daysLeft = daysLeft;
            $rootScope.standObjective = "";
        });

        sfiFormApp.run(function($rootScope) {
            $rootScope.$form = null;
            $rootScope.isSectionDirty = null;
            $rootScope.$isFormDirty = function(){
                if($rootScope.isSectionDirty){
                    return $rootScope.isSectionDirty();
                }
                if(!$rootScope.$form){
                    return false;
                }
                if(!($rootScope.$form instanceof Array)){
                    return $rootScope.$form.$dirty;
                }
                for(var key in $rootScope.$form){
                    var $form = $rootScope.$form[key];
                    if($form.$dirty){
                        return true;
                    }
                }
                return false;
            }
            $rootScope.$on('$stateChangeStart',
                    function(event, toState, toParams, fromState, fromParams){
                        if($rootScope.$isFormDirty()){
                            if(confirm("Are you want to leave this page ? You have unsaved changes")){
                                $rootScope.$form = null;
                                $rootScope.isSectionDirty = null;
                                return false;
                            }
                            event.preventDefault();
                        }
                    });
        });

        // ]]>
    </script>
    <script id="pop2tpl" type="text/template">

        <![CDATA[
        <div style="width:300px;">
            <form>
                <table>
                    <tr>
                        <td width="60%">Select standard combination if reporting volume certified to more than one standard</td>
                        <td>% certified</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" value="SFI/FSC" name="item1" class="icheck" icheck>&nbsp;SFI/FSC</td>
                        <td style="height: 45px;"><input name="val1" type="number" class="valbox form-control shorter"/></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" value="SFI/ATFS" name="item2" class="icheck" icheck>&nbsp;SFI/ATFS</td>
                        <td style="height: 45px;"><input name="val2" type="number" class="valbox form-control shorter"/></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" value="SFI/CSA" name="item3" class="icheck" icheck>&nbsp;SFI/CSA</td>
                        <td style="height: 45px;"><input name="val3" type="number" class="valbox form-control shorter"/></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" value="ATFS/FSC" name="item4" class="icheck" icheck>&nbsp;ATFS/FSC</td>
                        <td style="height: 45px;"><input name="val4" type="number" class="valbox form-control shorter"/></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" value="CSA/FSC" name="item5" class="icheck" icheck>&nbsp;CSA/FSC</td>
                        <td style="height: 45px;"><input name="val5" type="number" class="valbox form-control shorter"/></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" value="SFI/ATFS/FSC" name="item6" class="icheck" icheck >&nbsp;SFI/ATFS/FSC</td>
                        <td style="height: 45px;"><input name="val6" type="number" class="valbox form-control shorter"/></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" value="SFI/CSA/FSC" name="item7" class="icheck" icheck>&nbsp;SFI/CSA/FSC</td>
                        <td style="height: 45px;"><input name="val7" type="number" class="valbox form-control shorter"/></td>
                    </tr>
                </table>
                <div class="col-sm-6 specialpadding alignleft"><button type="button" class="btn btn-cancel">Cancel</button></div>
                <div class="col-sm-6 specialpadding alignright"><button type="button" class="btn btn-success">Ok</button> </div>
            </form>
        </div>

         ]]>
    </script>


    <script type="text/javascript">

    // <![CDATA[

        $( window ).load(function(){

            setTimeout(function(){
                isPrint && window.print()
            }, 2000);
        });

    // ]]>
    </script>

</div>

</html>